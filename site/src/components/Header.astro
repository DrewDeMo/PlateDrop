---
import { Flame, BookOpen, HelpCircle, Info, Mail, Menu, X } from 'lucide-astro';
const currentPath = Astro.url.pathname;
---

<header class="site-header" id="site-header">
  <div class="header-progress"></div>
  <div class="header-glow"></div>
  <div class="container">
    <nav class="nav-wrapper">
      <a href="/" class="logo">
        <div class="logo-icon">
          <img src="/svgs/logo.svg" alt="PlateDrop Logo" width="40" height="40" />
        </div>
        <span class="logo-text">
          <span class="logo-main">Plate</span><span class="logo-accent">Drop</span>
        </span>
      </a>
      
      <ul class="nav-links">
        <li>
          <a href="/" class={currentPath === '/' ? 'active' : ''}>
            <Flame class="nav-icon" size={20} />
            <span>Deals</span>
          </a>
        </li>
        <li>
          <a href="/guides" class={currentPath.startsWith('/guides') ? 'active' : ''}>
            <BookOpen class="nav-icon" size={20} />
            <span>Guides</span>
          </a>
        </li>
        <li>
          <a href="/faq" class={currentPath === '/faq' ? 'active' : ''}>
            <HelpCircle class="nav-icon" size={20} />
            <span>FAQ</span>
          </a>
        </li>
        <li>
          <a href="/about" class={currentPath === '/about' ? 'active' : ''}>
            <Info class="nav-icon" size={20} />
            <span>About</span>
          </a>
        </li>
        <li>
          <a href="/contact" class={currentPath === '/contact' ? 'active' : ''}>
            <Mail class="nav-icon" size={20} />
            <span>Contact</span>
          </a>
        </li>
      </ul>
      
      <button class="mobile-menu-toggle" aria-label="Toggle menu">
        <Menu class="menu-icon" size={24} />
        <X class="close-icon" size={24} />
      </button>
    </nav>
  </div>
</header>

<style>
  .site-header {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    border-bottom: 1px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    transition: box-shadow var(--transition-smooth), border-color var(--transition-base);
  }
  
  /* Scroll progress indicator */
  .header-progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 3px;
    background: var(--gradient-primary);
    width: 0%;
    transition: width 100ms ease-out;
    z-index: 2;
    box-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
  }
  
  /* Header shrinks on scroll */
  .site-header.scrolled {
    box-shadow: var(--shadow-2xl);
    border-bottom-color: rgba(255, 107, 53, 0.2);
  }
  
  .site-header.scrolled .nav-wrapper {
    padding-block: var(--space-3);
  }
  
  .site-header.scrolled .logo {
    font-size: var(--text-xl);
  }
  
  .site-header.scrolled .logo-icon {
    width: 40px;
    height: 40px;
  }
  
  .header-glow {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 100%;
    background: radial-gradient(ellipse at center, rgba(255, 107, 53, 0.15) 0%, transparent 70%);
    pointer-events: none;
    opacity: 0;
    transition: opacity var(--transition-smooth);
  }
  
  .site-header:hover .header-glow,
  .site-header.scrolled .header-glow {
    opacity: 1;
  }
  
  .nav-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-block: var(--space-5);
    gap: var(--space-8);
    position: relative;
  }
  
  .logo {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-size: var(--text-2xl);
    font-weight: 800;
    color: var(--color-text);
    text-decoration: none;
    transition: transform var(--transition-spring);
    position: relative;
    z-index: 2;
  }
  
  .logo:hover {
    transform: scale(1.08);
    text-decoration: none;
  }
  
  .logo:active {
    transform: scale(1.02);
    transition: transform 100ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .logo-icon {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
  }
  
  .logo-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform var(--transition-spring);
  }
  
  .logo-icon::before {
    content: '';
    position: absolute;
    inset: -4px;
    background: var(--gradient-primary);
    border-radius: 50%;
    opacity: 0;
    filter: blur(12px);
    transition: opacity var(--transition-smooth);
  }
  
  .logo:hover .logo-icon::before {
    opacity: 0.7;
  }
  
  .logo:hover .logo-icon img {
    transform: scale(1.1) rotate(5deg);
  }
  
  .logo-text {
    display: flex;
    letter-spacing: -0.02em;
  }
  
  .logo-main {
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .logo-accent {
    color: var(--color-text);
    font-weight: 700;
  }
  
  .nav-links {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .nav-links a {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--color-text-secondary);
    text-decoration: none;
    padding: var(--space-3) var(--space-5);
    border-radius: var(--radius-full);
    transition: color var(--transition-base), transform var(--transition-spring);
    position: relative;
    overflow: hidden;
  }
  
  .nav-links a::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--gradient-primary);
    opacity: 0;
    transition: opacity var(--transition-smooth);
    border-radius: var(--radius-full);
  }
  
  .nav-links a:hover::before {
    opacity: 0.15;
  }
  
  .nav-links a:hover {
    color: var(--color-primary);
    transform: translateY(-3px) scale(1.05);
    text-decoration: none;
  }
  
  .nav-links a:active {
    transform: translateY(-1px) scale(1.02);
    transition: transform 100ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .nav-icon {
    transition: transform var(--transition-spring), filter var(--transition-base);
    stroke-width: 2.5;
  }
  
  .nav-links a:hover .nav-icon {
    transform: scale(1.2) rotate(-8deg);
    filter: drop-shadow(0 0 10px rgba(255, 107, 53, 0.7));
  }
  
  .nav-links a.active {
    color: var(--color-text);
    background: var(--gradient-primary);
    box-shadow: var(--shadow-glow);
  }
  
  .nav-links a.active::before {
    opacity: 0;
  }
  
  .nav-links a.active .nav-icon {
    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.8));
    animation: pulse 2s ease-in-out infinite;
  }
  
  .mobile-menu-toggle {
    display: none;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--space-2);
    z-index: 2;
    position: relative;
    width: 44px;
    height: 44px;
    border-radius: var(--radius-md);
    transition: background var(--transition-base), transform var(--transition-spring);
  }
  
  .mobile-menu-toggle:hover {
    background: rgba(255, 107, 53, 0.15);
    transform: scale(1.1);
  }
  
  .mobile-menu-toggle:active {
    transform: scale(0.95);
    transition: transform 100ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .mobile-menu-toggle .menu-icon,
  .mobile-menu-toggle .close-icon {
    position: absolute;
    transition: opacity var(--transition-smooth), transform var(--transition-spring);
    color: var(--color-primary);
  }
  
  .mobile-menu-toggle .close-icon {
    opacity: 0;
    transform: rotate(-90deg) scale(0.8);
  }
  
  .mobile-menu-toggle.active .menu-icon {
    opacity: 0;
    transform: rotate(90deg) scale(0.8);
  }
  
  .mobile-menu-toggle.active .close-icon {
    opacity: 1;
    transform: rotate(0) scale(1);
  }
  
  @media (max-width: 768px) {
    .nav-wrapper {
      padding-block: var(--space-4);
    }
    
    .mobile-menu-toggle {
      display: flex;
    }
    
    .nav-links {
      position: fixed;
      top: 0;
      right: -100%;
      width: 280px;
      height: 100vh;
      background: var(--gradient-card);
      backdrop-filter: var(--glass-blur);
      flex-direction: column;
      padding: var(--space-20) var(--space-6);
      gap: var(--space-4);
      border-left: 1px solid var(--glass-border);
      box-shadow: var(--shadow-2xl);
      transition: right var(--transition-elastic);
    }
    
    .nav-links.active {
      right: 0;
    }
    
    .nav-links a {
      width: 100%;
      justify-content: flex-start;
      padding: var(--space-4) var(--space-5);
      font-size: var(--text-lg);
    }
    
    .logo-text {
      font-size: var(--text-xl);
    }
  }
  
  @media (max-width: 480px) {
    .logo-text span {
      font-size: var(--text-lg);
    }
    
    .nav-links {
      width: 100%;
      right: -100%;
    }
  }
</style>

<script>
  // Header scroll effects
  const header = document.getElementById('site-header');
  const headerProgress = document.querySelector('.header-progress') as HTMLElement;
  let lastScrollY = window.scrollY;
  let ticking = false;
  
  function updateHeader() {
    const scrollY = window.scrollY;
    
    // Add scrolled class when scrolled down
    if (scrollY > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
    
    // Update progress bar
    if (headerProgress) {
      const windowHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = (scrollY / windowHeight) * 100;
      headerProgress.style.width = `${Math.min(scrollPercent, 100)}%`;
    }
    
    lastScrollY = scrollY;
    ticking = false;
  }
  
  function requestTick() {
    if (!ticking) {
      window.requestAnimationFrame(updateHeader);
      ticking = true;
    }
  }
  
  window.addEventListener('scroll', requestTick, { passive: true });
  
  // Initial update
  updateHeader();
  
  // Mobile menu toggle
  const menuToggle = document.querySelector('.mobile-menu-toggle');
  const navLinks = document.querySelector('.nav-links');
  
  if (menuToggle && navLinks) {
    menuToggle.addEventListener('click', () => {
      navLinks.classList.toggle('active');
      menuToggle.classList.toggle('active');
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!menuToggle.contains(e.target as Node) && !navLinks.contains(e.target as Node)) {
        navLinks.classList.remove('active');
        menuToggle.classList.remove('active');
      }
    });
    
    // Close menu when clicking a link
    navLinks.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        navLinks.classList.remove('active');
        menuToggle.classList.remove('active');
      });
    });
  }
  
  // Add stagger animation to nav items on load
  const navItems = document.querySelectorAll('.nav-links li');
  navItems.forEach((item, index) => {
    (item as HTMLElement).style.animation = `slideIn 0.5s ease-out ${index * 0.1}s both`;
  });
</script>
